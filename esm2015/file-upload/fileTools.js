export function getWindow() { return window; }
export function acceptType(accept, type, name) {
    if (!accept) {
        return true;
    }
    const defs = accept.split(',');
    let regx;
    let acceptRegString;
    for (let x = defs.length - 1; x >= 0; --x) {
        //Escapes dots in mimetype 
        acceptRegString = defs[x];
        //trim
        acceptRegString = acceptRegString.replace(/(^\s+|\s+$)/g, '');
        //Escapes stars in mimetype 
        acceptRegString = acceptRegString.replace(/\*/g, '.*');
        //let acceptReg = '^((' + acceptRegString
        //acceptReg = acceptReg.replace(/,/g,')|(') + '))$'
        //try by mime
        regx = new RegExp(acceptRegString, 'gi');
        if (type.search(regx) >= 0) {
            return true;
        }
        //try by ext
        if (acceptRegString.substring(0, 1) == '.') {
            acceptRegString = '\\' + acceptRegString; //.substring(1, acceptRegString.length-1)//remove dot at front
            regx = new RegExp(acceptRegString + '$', 'i');
            if ((name || type).search(regx) >= 0) {
                return true;
            }
        }
    }
    return false;
}
export function arrayBufferToBase64(buffer) {
    var binary = '';
    var bytes = new Uint8Array(buffer);
    var len = bytes.byteLength;
    for (var i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
}
export function dataUrltoBlob(dataurl, name, origSize) {
    var arr = dataurl.split(',');
    var mimeMatch = arr[0].match(/:(.*?);/);
    var mime = mimeMatch ? mimeMatch[1] : 'text/plain';
    var bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    var blob = new window.Blob([u8arr], { type: mime });
    blob["name"] = name;
    blob["$ngfOrigSize"] = origSize;
    return blob;
}
export function applyTransform(ctx, orientation, width, height) {
    switch (orientation) {
        case 2:
            return ctx.transform(-1, 0, 0, 1, width, 0);
        case 3:
            return ctx.transform(-1, 0, 0, -1, width, height);
        case 4:
            return ctx.transform(1, 0, 0, -1, 0, height);
        case 5:
            return ctx.transform(0, 1, 1, 0, 0, 0);
        case 6:
            return ctx.transform(0, 1, -1, 0, height, 0);
        case 7:
            return ctx.transform(0, -1, -1, 0, height, width);
        case 8:
            return ctx.transform(0, -1, 1, 0, 0, width);
    }
}
export function fixFileOrientationByMeta(file, result) {
    return dataUrl(file, true)
        .then(url => {
        var canvas = document.createElement('canvas');
        var img = document.createElement('img');
        return new Promise(function (res, rej) {
            img.onload = function () {
                try {
                    canvas.width = result.orientation > 4 ? img.height : img.width;
                    canvas.height = result.orientation > 4 ? img.width : img.height;
                    var ctx = canvas.getContext('2d');
                    applyTransform(ctx, result.orientation, img.width, img.height);
                    ctx.drawImage(img, 0, 0);
                    var dataUrl = canvas.toDataURL(file.type || 'image/WebP', 0.934);
                    const base = arrayBufferToBase64(result.fixedArrayBuffer);
                    dataUrl = restoreExif(base, dataUrl);
                    var blob = dataUrltoBlob(dataUrl, file.name);
                    const newFile = blobToFile(blob, file.name);
                    res(newFile);
                }
                catch (e) {
                    rej(e);
                }
            };
            img.onerror = rej;
            img.src = url;
        });
    });
}
export function applyExifRotation(file) {
    if (file.type.indexOf('image/jpeg') !== 0) {
        return Promise.resolve(file);
    }
    return readOrientation(file)
        .then((result) => {
        if (result.orientation < 2 || result.orientation > 8) {
            return file;
        }
        return fixFileOrientationByMeta(file, result);
    });
}
export function readOrientation(file) {
    return new Promise((res, rej) => {
        var reader = new FileReader();
        var slicedFile = file.slice ? file.slice(0, 64 * 1024) : file;
        reader.readAsArrayBuffer(slicedFile);
        reader.onerror = rej;
        reader.onload = function (e) {
            var result = { orientation: 1 };
            var view = new DataView(this.result);
            if (view.getUint16(0, false) !== 0xFFD8)
                return res(result);
            var length = view.byteLength, offset = 2;
            while (offset < length) {
                var marker = view.getUint16(offset, false);
                offset += 2;
                if (marker === 0xFFE1) {
                    if (view.getUint32(offset += 2, false) !== 0x45786966)
                        return res(result);
                    var little = view.getUint16(offset += 6, false) === 0x4949;
                    offset += view.getUint32(offset + 4, little);
                    var tags = view.getUint16(offset, little);
                    offset += 2;
                    for (var i = 0; i < tags; i++)
                        if (view.getUint16(offset + (i * 12), little) === 0x0112) {
                            var orientation = view.getUint16(offset + (i * 12) + 8, little);
                            if (orientation >= 2 && orientation <= 8) {
                                view.setUint16(offset + (i * 12) + 8, 1, little);
                                result.fixedArrayBuffer = e.target.result;
                            }
                            result.orientation = orientation;
                            return res(result);
                        }
                }
                else if ((marker & 0xFF00) !== 0xFF00)
                    break;
                else
                    offset += view.getUint16(offset, false);
            }
            return res(result);
        };
    });
}
/** converts file-input file into base64 dataUri */
export function dataUrl(file, disallowObjectUrl) {
    if (!file)
        return Promise.resolve(file);
    if ((disallowObjectUrl && file.$ngfDataUrl != null) || (!disallowObjectUrl && file.$ngfBlobUrl != null)) {
        return Promise.resolve(disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl);
    }
    var p = disallowObjectUrl ? file.$$ngfDataUrlPromise : file.$$ngfBlobUrlPromise;
    if (p)
        return p;
    const win = getWindow();
    let deferred;
    if (win.FileReader && file &&
        (!win.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&
        (!win.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {
        //prefer URL.createObjectURL for handling refrences to files of all sizes
        //since it doesnÂ´t build a large string in memory
        var URL = win.URL || win.webkitURL;
        if (FileReader) {
            deferred = new Promise((res, rej) => {
                var fileReader = new FileReader();
                fileReader.onload = function (event) {
                    file.$ngfDataUrl = event.target.result;
                    delete file.$ngfDataUrl;
                    res(event.target.result);
                };
                fileReader.onerror = function (e) {
                    file.$ngfDataUrl = '';
                    rej(e);
                };
                fileReader.readAsDataURL(file);
            });
        }
        else {
            var url;
            try {
                url = URL.createObjectURL(file);
            }
            catch (e) {
                return Promise.reject(e);
            }
            deferred = Promise.resolve(url);
            file.$ngfBlobUrl = url;
        }
    }
    else {
        file[disallowObjectUrl ? '$ngfDataUrl' : '$ngfBlobUrl'] = '';
        return Promise.reject(new Error('Browser does not support window.FileReader, window.FileReader, or window.FileAPI')); //deferred.reject();
    }
    if (disallowObjectUrl) {
        p = file.$$ngfDataUrlPromise = deferred;
    }
    else {
        p = file.$$ngfBlobUrlPromise = deferred;
    }
    p = p.then((x) => {
        delete file[disallowObjectUrl ? '$$ngfDataUrlPromise' : '$$ngfBlobUrlPromise'];
        return x;
    });
    return p;
}
export function restoreExif(orig, resized) {
    var ExifRestorer = {
        KEY_STR: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
    };
    ExifRestorer.encode64 = function (input) {
        var output = '', chr1, chr2, chr3 = '', enc1, enc2, enc3, enc4 = '', i = 0;
        do {
            chr1 = input[i++];
            chr2 = input[i++];
            chr3 = input[i++];
            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;
            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            }
            else if (isNaN(chr3)) {
                enc4 = 64;
            }
            output = output +
                this.KEY_STR.charAt(enc1) +
                this.KEY_STR.charAt(enc2) +
                this.KEY_STR.charAt(enc3) +
                this.KEY_STR.charAt(enc4);
            chr1 = chr2 = chr3 = '';
            enc1 = enc2 = enc3 = enc4 = '';
        } while (i < input.length);
        return output;
    };
    ExifRestorer.restore = function (origFileBase64, resizedFileBase64) {
        if (origFileBase64.match('data:image/jpeg;base64,')) {
            origFileBase64 = origFileBase64.replace('data:image/jpeg;base64,', '');
        }
        var rawImage = this.decode64(origFileBase64);
        var segments = this.slice2Segments(rawImage);
        var image = this.exifManipulation(resizedFileBase64, segments);
        return 'data:image/jpeg;base64,' + this.encode64(image);
    };
    ExifRestorer.exifManipulation = function (resizedFileBase64, segments) {
        var exifArray = this.getExifArray(segments), newImageArray = this.insertExif(resizedFileBase64, exifArray);
        return new Uint8Array(newImageArray);
    };
    ExifRestorer.getExifArray = function (segments) {
        var seg;
        for (var x = 0; x < segments.length; x++) {
            seg = segments[x];
            if (seg[0] === 255 && seg[1] === 225) //(ff e1)
             {
                return seg;
            }
        }
        return [];
    };
    ExifRestorer.insertExif = function (resizedFileBase64, exifArray) {
        var imageData = resizedFileBase64.replace('data:image/jpeg;base64,', ''), buf = this.decode64(imageData), separatePoint = buf.indexOf(255, 3), mae = buf.slice(0, separatePoint), ato = buf.slice(separatePoint), array = mae;
        array = array.concat(exifArray);
        array = array.concat(ato);
        return array;
    };
    ExifRestorer.slice2Segments = function (rawImageArray) {
        var head = 0, segments = [];
        while (1) {
            if (rawImageArray[head] === 255 && rawImageArray[head + 1] === 218) {
                break;
            }
            if (rawImageArray[head] === 255 && rawImageArray[head + 1] === 216) {
                head += 2;
            }
            else {
                var length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3];
                var endPoint = head + length + 2;
                var seg = rawImageArray.slice(head, endPoint);
                segments.push(seg);
                head = endPoint;
            }
            if (head > rawImageArray.length) {
                break;
            }
        }
        return segments;
    };
    ExifRestorer.decode64 = function (input) {
        var chr1, chr2, chr3 = '', enc1, enc2, enc3, enc4 = '', i = 0, buf = [];
        // remove all characters that are not A-Z, a-z, 0-9, +, /, or =
        var base64test = /[^A-Za-z0-9\+\/\=]/g;
        if (base64test.exec(input)) {
            console.log('There were invalid base64 characters in the input text.');
        }
        input = input.replace(/[^A-Za-z0-9\+\/\=]/g, '');
        do {
            enc1 = this.KEY_STR.indexOf(input.charAt(i++));
            enc2 = this.KEY_STR.indexOf(input.charAt(i++));
            enc3 = this.KEY_STR.indexOf(input.charAt(i++));
            enc4 = this.KEY_STR.indexOf(input.charAt(i++));
            chr1 = (enc1 << 2) | (enc2 >> 4);
            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
            chr3 = ((enc3 & 3) << 6) | enc4;
            buf.push(chr1);
            if (enc3 !== 64) {
                buf.push(chr2);
            }
            if (enc4 !== 64) {
                buf.push(chr3);
            }
            chr1 = chr2 = chr3 = '';
            enc1 = enc2 = enc3 = enc4 = '';
        } while (i < input.length);
        return buf;
    };
    return ExifRestorer.restore(orig, resized); //<= EXIF
}
;
function blobToFile(theBlob, fileName) {
    var b = theBlob;
    //A Blob() is almost a File() - it's just missing the two properties below which we will add
    b.lastModifiedDate = new Date();
    b.name = fileName;
    //Cast to a File() type
    return theBlob;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZVRvb2xzLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9hY2tlcmFwcGxlL1Byb2plY3RzL3dlYi9hbmd1bGFyL2FuZ3VsYXItZmlsZS9kZXZlbG9wbWVudC9wcm9qZWN0cy9hbmd1bGFyLWZpbGUvc3JjLyIsInNvdXJjZXMiOlsiZmlsZS11cGxvYWQvZmlsZVRvb2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sVUFBVSxTQUFTLEtBQU8sT0FBTyxNQUFNLENBQUEsQ0FBQSxDQUFDO0FBRTlDLE1BQU0sVUFBVSxVQUFVLENBQUMsTUFBYSxFQUFFLElBQVcsRUFBRSxJQUFZO0lBQ2pFLElBQUksQ0FBQyxNQUFNLEVBQUU7UUFDWCxPQUFPLElBQUksQ0FBQTtLQUNaO0lBRUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUM5QixJQUFJLElBQVcsQ0FBQTtJQUNmLElBQUksZUFBc0IsQ0FBQTtJQUUxQixLQUFJLElBQUksQ0FBQyxHQUFDLElBQUksQ0FBQyxNQUFNLEdBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUM7UUFDbkMsMkJBQTJCO1FBQzNCLGVBQWUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDekIsTUFBTTtRQUNOLGVBQWUsR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBQyxFQUFFLENBQUMsQ0FBQTtRQUM1RCw0QkFBNEI7UUFDNUIsZUFBZSxHQUFHLGVBQWUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFDLElBQUksQ0FBQyxDQUFBO1FBQ3JELHlDQUF5QztRQUN6QyxtREFBbUQ7UUFFbkQsYUFBYTtRQUNiLElBQUksR0FBRyxJQUFJLE1BQU0sQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDeEMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFFLENBQUMsRUFBRTtZQUN4QixPQUFP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QUFDO1lBRWhDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFZixJQUFJLElBQUksS0FBSyxFQUFFLEVBQUU7Z0JBQ2YsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNoQjtZQUNELElBQUksSUFBSSxLQUFLLEVBQUUsRUFBRTtnQkFDZixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ2hCO1lBRUQsSUFBSSxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ3hCLElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7U0FFaEMsUUFBUSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRTtRQUUzQixPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUMsQ0FBQztJQUVGLE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBRSxTQUFTO0FBQ3hELENBQUM7QUFBQSxDQUFDO0FBRUYsU0FBUyxVQUFVLENBQUMsT0FBYSxFQUFFLFFBQWU7SUFDaEQsSUFBSSxDQUFDLEdBQVEsT0FBTyxDQUFDO0lBQ3JCLDRGQUE0RjtJQUM1RixDQUFDLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUNoQyxDQUFDLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUVsQix1QkFBdUI7SUFDdkIsT0FBYSxPQUFPLENBQUM7QUFDdkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBnZXRXaW5kb3coKTphbnl7cmV0dXJuIHdpbmRvd31cblxuZXhwb3J0IGZ1bmN0aW9uIGFjY2VwdFR5cGUoYWNjZXB0OnN0cmluZywgdHlwZTpzdHJpbmcsIG5hbWU/OnN0cmluZyk6Ym9vbGVhbiB7ICAgXG4gIGlmKCAhYWNjZXB0ICl7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGNvbnN0IGRlZnMgPSBhY2NlcHQuc3BsaXQoJywnKVxuICBsZXQgcmVneDpSZWdFeHBcbiAgbGV0IGFjY2VwdFJlZ1N0cmluZzpzdHJpbmdcblxuICBmb3IobGV0IHg9ZGVmcy5sZW5ndGgtMTsgeCA+PSAwOyAtLXgpe1xuICAgIC8vRXNjYXBlcyBkb3RzIGluIG1pbWV0eXBlIFxuICAgIGFjY2VwdFJlZ1N0cmluZyA9IGRlZnNbeF1cbiAgICAvL3RyaW1cbiAgICBhY2NlcHRSZWdTdHJpbmcgPSBhY2NlcHRSZWdTdHJpbmcucmVwbGFjZSgvKF5cXHMrfFxccyskKS9nLCcnKVxuICAgIC8vRXNjYXBlcyBzdGFycyBpbiBtaW1ldHlwZSBcbiAgICBhY2NlcHRSZWdTdHJpbmcgPSBhY2NlcHRSZWdTdHJpbmcucmVwbGFjZSgvXFwqL2csJy4qJylcbiAgICAvL2xldCBhY2NlcHRSZWcgPSAnXigoJyArIGFjY2VwdFJlZ1N0cmluZ1xuICAgIC8vYWNjZXB0UmVnID0gYWNjZXB0UmVnLnJlcGxhY2UoLywvZywnKXwoJykgKyAnKSkkJ1xuICAgIFxuICAgIC8vdHJ5IGJ5IG1pbWVcbiAgICByZWd4ID0gbmV3IFJlZ0V4cChhY2NlcHRSZWdTdHJpbmcsICdnaScpXG4gICAgaWYoIHR5cGUuc2VhcmNoKHJlZ3gpPj0wICl7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIC8vdHJ5IGJ5IGV4dFxuICAgIGlmKCBhY2NlcHRSZWdTdHJpbmcuc3Vic3RyaW5nKDAsIDEpPT0nLicgKXsgICAgICBcbiAgICAgIGFjY2VwdFJlZ1N0cmluZyA9ICdcXFxcJysgYWNjZXB0UmVnU3RyaW5nLy8uc3Vic3RyaW5nKDEsIGFjY2VwdFJlZ1N0cmluZy5sZW5ndGgtMSkvL3JlbW92ZSBkb3QgYXQgZnJvbnRcbiAgICAgIHJlZ3ggPSBuZXcgUmVnRXhwKGFjY2VwdFJlZ1N0cmluZysnJCcsICdpJylcbiAgICAgIGlmKCAobmFtZXx8dHlwZSkuc2VhcmNoKHJlZ3gpPj0wICl7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEludmFsaWRGaWxlSXRlbXtcbiAgZmlsZTpGaWxlXG4gIHR5cGU6c3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcnJheUJ1ZmZlclRvQmFzZTY0KGJ1ZmZlcjphbnkpIHtcbiAgdmFyIGJpbmFyeSA9ICcnO1xuICB2YXIgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICB2YXIgbGVuID0gYnl0ZXMuYnl0ZUxlbmd0aDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgIGJpbmFyeSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGVzW2ldKTtcbiAgfVxuICByZXR1cm4gd2luZG93LmJ0b2EoYmluYXJ5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRhdGFVcmx0b0Jsb2IoXG4gIGRhdGF1cmw6c3RyaW5nLFxuICBuYW1lOnN0cmluZyxcbiAgb3JpZ1NpemU/OmFueVxuKTpCbG9ie1xuICB2YXIgYXJyID0gZGF0YXVybC5zcGxpdCgnLCcpO1xuICB2YXIgbWltZU1hdGNoID0gYXJyWzBdLm1hdGNoKC86KC4qPyk7LylcbiAgdmFyIG1pbWU6c3RyaW5nID0gbWltZU1hdGNoID8gbWltZU1hdGNoWzFdIDogJ3RleHQvcGxhaW4nXG4gIHZhciBic3RyID0gYXRvYihhcnJbMV0pLCBuID0gYnN0ci5sZW5ndGgsIHU4YXJyID0gbmV3IFVpbnQ4QXJyYXkobik7XG4gIHdoaWxlIChuLS0pIHtcbiAgICB1OGFycltuXSA9IGJzdHIuY2hhckNvZGVBdChuKTtcbiAgfVxuICB2YXIgYmxvYiA9IG5ldyB3aW5kb3cuQmxvYihbdThhcnJdLCB7dHlwZTogbWltZX0pO1xuICBibG9iW1wibmFtZVwiXSA9IG5hbWU7XG4gIGJsb2JbXCIkbmdmT3JpZ1NpemVcIl0gPSBvcmlnU2l6ZTtcbiAgcmV0dXJuIGJsb2I7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2Ugb3JpZW50YXRpb25NZXRhe1xuICBvcmllbnRhdGlvbjogbnVtYmVyXG4gIGZpeGVkQXJyYXlCdWZmZXI/OmFueVtdXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVRyYW5zZm9ybShcbiAgY3R4OkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcbiAgb3JpZW50YXRpb246bnVtYmVyLFxuICB3aWR0aDpudW1iZXIsXG4gIGhlaWdodDpudW1iZXJcbikge1xuICBzd2l0Y2ggKG9yaWVudGF0aW9uKSB7XG4gICAgY2FzZSAyOlxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oLTEsIDAsIDAsIDEsIHdpZHRoLCAwKTtcbiAgICBjYXNlIDM6XG4gICAgICByZXR1cm4gY3R4LnRyYW5zZm9ybSgtMSwgMCwgMCwgLTEsIHdpZHRoLCBoZWlnaHQpO1xuICAgIGNhc2UgNDpcbiAgICAgIHJldHVybiBjdHgudHJhbnNmb3JtKDEsIDAsIDAsIC0xLCAwLCBoZWlnaHQpO1xuICAgIGNhc2UgNTpcbiAgICAgIHJldHVybiBjdHgudHJhbnNmb3JtKDAsIDEsIDEsIDAsIDAsIDApO1xuICAgIGNhc2UgNjpcbiAgICAgIHJldHVybiBjdHgudHJhbnNmb3JtKDAsIDEsIC0xLCAwLCBoZWlnaHQsIDApO1xuICAgIGNhc2UgNzpcbiAgICAgIHJldHVybiBjdHgudHJhbnNmb3JtKDAsIC0xLCAtMSwgMCwgaGVpZ2h0LCB3aWR0aCk7XG4gICAgY2FzZSA4OlxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oMCwgLTEsIDEsIDAsIDAsIHdpZHRoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZml4RmlsZU9yaWVudGF0aW9uQnlNZXRhKFxuICBmaWxlOkZpbGUsIHJlc3VsdDpvcmllbnRhdGlvbk1ldGFcbik6UHJvbWlzZTxGaWxlPntcbiAgcmV0dXJuIGRhdGFVcmwoZmlsZSwgdHJ1ZSlcbiAgLnRoZW4odXJsPT57XG4gICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblxuICAgIHJldHVybiA8UHJvbWlzZTxGaWxlPj5uZXcgUHJvbWlzZShmdW5jdGlvbihyZXMscmVqKXtcbiAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY2FudmFzLndpZHRoID0gcmVzdWx0Lm9yaWVudGF0aW9uID4gNCA/IGltZy5oZWlnaHQgOiBpbWcud2lkdGhcbiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gcmVzdWx0Lm9yaWVudGF0aW9uID4gNCA/IGltZy53aWR0aCA6IGltZy5oZWlnaHRcbiAgICAgICAgICB2YXIgY3R4ID0gPENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRD5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuICAgICAgICAgIGFwcGx5VHJhbnNmb3JtKGN0eCwgcmVzdWx0Lm9yaWVudGF0aW9uLCBpbWcud2lkdGgsIGltZy5oZWlnaHQpXG4gICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApO1xuICAgICAgICAgIHZhciBkYXRhVXJsID0gY2FudmFzLnRvRGF0YVVSTChmaWxlLnR5cGUgfHwgJ2ltYWdlL1dlYlAnLCAwLjkzNClcbiAgICAgICAgICBjb25zdCBiYXNlID0gYXJyYXlCdWZmZXJUb0Jhc2U2NChyZXN1bHQuZml4ZWRBcnJheUJ1ZmZlcilcbiAgICAgICAgICBkYXRhVXJsID0gcmVzdG9yZUV4aWYoYmFzZSwgZGF0YVVybClcbiAgICAgICAgICB2YXIgYmxvYiA9IGRhdGFVcmx0b0Jsb2IoZGF0YVVybCwgZmlsZS5uYW1lKVxuICAgICAgICAgIGNvbnN0IG5ld0ZpbGUgPSBibG9iVG9GaWxlKGJsb2IsIGZpbGUubmFtZSk7XG4gICAgICAgICAgcmVzKG5ld0ZpbGUpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmVqKGUpXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBpbWcub25lcnJvciA9IHJlajtcbiAgICAgIGltZy5zcmMgPSB1cmw7ICAgIFxuICAgIH0pXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseUV4aWZSb3RhdGlvbihcbiAgZmlsZTpGaWxlXG4pOlByb21pc2U8RmlsZT57XG4gIGlmIChmaWxlLnR5cGUuaW5kZXhPZignaW1hZ2UvanBlZycpICE9PSAwKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmaWxlKTtcbiAgfVxuXG4gIHJldHVybiByZWFkT3JpZW50YXRpb24oZmlsZSlcbiAgLnRoZW4oKHJlc3VsdDpvcmllbnRhdGlvbk1ldGEpPT57XG4gICAgaWYgKHJlc3VsdC5vcmllbnRhdGlvbiA8IDIgfHwgcmVzdWx0Lm9yaWVudGF0aW9uID4gOCkge1xuICAgICAgcmV0dXJuIGZpbGVcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZpeEZpbGVPcmllbnRhdGlvbkJ5TWV0YShmaWxlLHJlc3VsdClcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRPcmllbnRhdGlvbihcbiAgZmlsZTpGaWxlXG4pOlByb21pc2U8b3JpZW50YXRpb25NZXRhPntcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMscmVqKT0+e1xuICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIHZhciBzbGljZWRGaWxlID0gZmlsZS5zbGljZSA/IGZpbGUuc2xpY2UoMCwgNjQgKiAxMDI0KSA6IGZpbGU7XG4gICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHNsaWNlZEZpbGUpO1xuICAgIHJlYWRlci5vbmVycm9yID0gcmVqXG4gICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlOmFueSkge1xuICAgICAgdmFyIHJlc3VsdDpvcmllbnRhdGlvbk1ldGEgPSB7b3JpZW50YXRpb246IDF9O1xuICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoIDxBcnJheUJ1ZmZlcj50aGlzLnJlc3VsdCApO1xuICAgICAgaWYgKHZpZXcuZ2V0VWludDE2KDAsIGZhbHNlKSAhPT0gMHhGRkQ4KSByZXR1cm4gcmVzKHJlc3VsdCk7XG5cbiAgICAgIHZhciBsZW5ndGggPSB2aWV3LmJ5dGVMZW5ndGgsXG4gICAgICAgIG9mZnNldCA9IDI7XG4gICAgICB3aGlsZSAob2Zmc2V0IDwgbGVuZ3RoKSB7XG4gICAgICAgIHZhciBtYXJrZXIgPSB2aWV3LmdldFVpbnQxNihvZmZzZXQsIGZhbHNlKTtcbiAgICAgICAgb2Zmc2V0ICs9IDI7XG4gICAgICAgIGlmIChtYXJrZXIgPT09IDB4RkZFMSkge1xuICAgICAgICAgIGlmICh2aWV3LmdldFVpbnQzMihvZmZzZXQgKz0gMiwgZmFsc2UpICE9PSAweDQ1Nzg2OTY2KSByZXR1cm4gcmVzKHJlc3VsdCk7XG5cbiAgICAgICAgICB2YXIgbGl0dGxlID0gdmlldy5nZXRVaW50MTYob2Zmc2V0ICs9IDYsIGZhbHNlKSA9PT0gMHg0OTQ5O1xuICAgICAgICAgIG9mZnNldCArPSB2aWV3LmdldFVpbnQzMihvZmZzZXQgKyA0LCBsaXR0bGUpO1xuICAgICAgICAgIHZhciB0YWdzID0gdmlldy5nZXRVaW50MTYob2Zmc2V0LCBsaXR0bGUpO1xuICAgICAgICAgIG9mZnNldCArPSAyO1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFnczsgaSsrKVxuICAgICAgICAgICAgaWYgKHZpZXcuZ2V0VWludDE2KG9mZnNldCArIChpICogMTIpLCBsaXR0bGUpID09PSAweDAxMTIpIHtcbiAgICAgICAgICAgICAgdmFyIG9yaWVudGF0aW9uID0gdmlldy5nZXRVaW50MTYob2Zmc2V0ICsgKGkgKiAxMikgKyA4LCBsaXR0bGUpO1xuICAgICAgICAgICAgICBpZiAob3JpZW50YXRpb24gPj0gMiAmJiBvcmllbnRhdGlvbiA8PSA4KSB7XG4gICAgICAgICAgICAgICAgdmlldy5zZXRVaW50MTYob2Zmc2V0ICsgKGkgKiAxMikgKyA4LCAxLCBsaXR0bGUpO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5maXhlZEFycmF5QnVmZmVyID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJlc3VsdC5vcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzKHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoKG1hcmtlciAmIDB4RkYwMCkgIT09IDB4RkYwMCkgYnJlYWs7XG4gICAgICAgIGVsc2Ugb2Zmc2V0ICs9IHZpZXcuZ2V0VWludDE2KG9mZnNldCwgZmFsc2UpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcyhyZXN1bHQpO1xuICAgIH07XG4gIH0pXG59XG5cbi8qKiBjb252ZXJ0cyBmaWxlLWlucHV0IGZpbGUgaW50byBiYXNlNjQgZGF0YVVyaSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRhdGFVcmwoXG4gIGZpbGU6YW55LFxuICBkaXNhbGxvd09iamVjdFVybD86YW55XG4pOlByb21pc2U8c3RyaW5nPntcbiAgaWYgKCFmaWxlKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZpbGUpXG4gIFxuICBpZiAoKGRpc2FsbG93T2JqZWN0VXJsICYmIGZpbGUuJG5nZkRhdGFVcmwgIT0gbnVsbCkgfHwgKCFkaXNhbGxvd09iamVjdFVybCAmJiBmaWxlLiRuZ2ZCbG9iVXJsICE9IG51bGwpKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSggZGlzYWxsb3dPYmplY3RVcmwgPyBmaWxlLiRuZ2ZEYXRhVXJsIDogZmlsZS4kbmdmQmxvYlVybCApXG4gIH1cblxuICB2YXIgcCA9IGRpc2FsbG93T2JqZWN0VXJsID8gZmlsZS4kJG5nZkRhdGFVcmxQcm9taXNlIDogZmlsZS4kJG5nZkJsb2JVcmxQcm9taXNlO1xuICBpZiAocCkgcmV0dXJuIHA7XG5cbiAgY29uc3Qgd2luID0gZ2V0V2luZG93KClcbiAgbGV0IGRlZmVycmVkOlByb21pc2U8c3RyaW5nPlxuICBpZiAod2luLkZpbGVSZWFkZXIgJiYgZmlsZSAmJlxuICAgICghd2luLkZpbGVBUEkgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFIDgnKSA9PT0gLTEgfHwgZmlsZS5zaXplIDwgMjAwMDApICYmXG4gICAgKCF3aW4uRmlsZUFQSSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01TSUUgOScpID09PSAtMSB8fCBmaWxlLnNpemUgPCA0MDAwMDAwKSkge1xuICAgIC8vcHJlZmVyIFVSTC5jcmVhdGVPYmplY3RVUkwgZm9yIGhhbmRsaW5nIHJlZnJlbmNlcyB0byBmaWxlcyBvZiBhbGwgc2l6ZXNcbiAgICAvL3NpbmNlIGl0IGRvZXNuwrR0IGJ1aWxkIGEgbGFyZ2Ugc3RyaW5nIGluIG1lbW9yeVxuICAgIHZhciBVUkwgPSB3aW4uVVJMIHx8IHdpbi53ZWJraXRVUkw7XG4gICAgaWYgKEZpbGVSZWFkZXIpIHtcbiAgICAgIGRlZmVycmVkID0gbmV3IFByb21pc2UoKHJlcyxyZWopPT57XG4gICAgICAgIHZhciBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZXZlbnQ6YW55KSB7XG4gICAgICAgICAgZmlsZS4kbmdmRGF0YVVybCA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgZGVsZXRlIGZpbGUuJG5nZkRhdGFVcmw7XG4gICAgICAgICAgcmVzKCBldmVudC50YXJnZXQucmVzdWx0IClcbiAgICAgICAgfTtcbiAgICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlLiRuZ2ZEYXRhVXJsID0gJyc7XG4gICAgICAgICAgcmVqKGUpXG4gICAgICAgIH07XG4gICAgICAgIGZpbGVSZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB1cmw6YW55O1xuICAgICAgdHJ5IHtcbiAgICAgICAgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBkZWZlcnJlZCA9IFByb21pc2UucmVzb2x2ZSggdXJsIClcbiAgICAgIGZpbGUuJG5nZkJsb2JVcmwgPSB1cmw7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZpbGVbZGlzYWxsb3dPYmplY3RVcmwgPyAnJG5nZkRhdGFVcmwnIDogJyRuZ2ZCbG9iVXJsJ10gPSAnJztcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoIG5ldyBFcnJvcignQnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHdpbmRvdy5GaWxlUmVhZGVyLCB3aW5kb3cuRmlsZVJlYWRlciwgb3Igd2luZG93LkZpbGVBUEknKSApLy9kZWZlcnJlZC5yZWplY3QoKTtcbiAgfVxuXG4gIGlmIChkaXNhbGxvd09iamVjdFVybCkge1xuICAgIHAgPSBmaWxlLiQkbmdmRGF0YVVybFByb21pc2UgPSBkZWZlcnJlZDtcbiAgfSBlbHNlIHtcbiAgICBwID0gZmlsZS4kJG5nZkJsb2JVcmxQcm9taXNlID0gZGVmZXJyZWQ7XG4gIH1cblxuICBwID0gcC50aGVuKCh4OmFueSk9PntcbiAgICBkZWxldGUgZmlsZVtkaXNhbGxvd09iamVjdFVybCA/ICckJG5nZkRhdGFVcmxQcm9taXNlJyA6ICckJG5nZkJsb2JVcmxQcm9taXNlJ107XG4gICAgcmV0dXJuIHhcbiAgfSlcblxuICByZXR1cm4gcDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc3RvcmVFeGlmKG9yaWc6YW55LCByZXNpemVkOmFueSkge1xuICB2YXIgRXhpZlJlc3RvcmVyOmFueSA9IHtcbiAgICBLRVlfU1RSOidBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSdcbiAgfVxuXG4gIEV4aWZSZXN0b3Jlci5lbmNvZGU2NCA9IGZ1bmN0aW9uIChpbnB1dDphbnkpIHtcbiAgICB2YXIgb3V0cHV0ID0gJycsXG4gICAgICBjaHIxLCBjaHIyLCBjaHIzOmFueSA9ICcnLFxuICAgICAgZW5jMSwgZW5jMiwgZW5jMywgZW5jNDphbnkgPSAnJyxcbiAgICAgIGkgPSAwO1xuXG4gICAgZG8ge1xuICAgICAgY2hyMSA9IGlucHV0W2krK107XG4gICAgICBjaHIyID0gaW5wdXRbaSsrXTtcbiAgICAgIGNocjMgPSBpbnB1dFtpKytdO1xuXG4gICAgICBlbmMxID0gY2hyMSA+PiAyO1xuICAgICAgZW5jMiA9ICgoY2hyMSAmIDMpIDw8IDQpIHwgKGNocjIgPj4gNCk7XG4gICAgICBlbmMzID0gKChjaHIyICYgMTUpIDw8IDIpIHwgKGNocjMgPj4gNik7XG4gICAgICBlbmM0ID0gY2hyMyAmIDYzO1xuXG4gICAgICBpZiAoaXNOYU4oY2hyMikpIHtcbiAgICAgICAgZW5jMyA9IGVuYzQgPSA2NDtcbiAgICAgIH0gZWxzZSBpZiAoaXNOYU4oY2hyMykpIHtcbiAgICAgICAgZW5jNCA9IDY0O1xuICAgICAgfVxuXG4gICAgICBvdXRwdXQgPSBvdXRwdXQgK1xuICAgICAgICB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzEpICtcbiAgICAgICAgdGhpcy5LRVlfU1RSLmNoYXJBdChlbmMyKSArXG4gICAgICAgIHRoaXMuS0VZX1NUUi5jaGFyQXQoZW5jMykgK1xuICAgICAgICB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzQpO1xuICAgICAgY2hyMSA9IGNocjIgPSBjaHIzID0gJyc7XG4gICAgICBlbmMxID0gZW5jMiA9IGVuYzMgPSBlbmM0ID0gJyc7XG4gICAgfSB3aGlsZSAoaSA8IGlucHV0Lmxlbmd0aCk7XG5cbiAgICByZXR1cm4gb3V0cHV0O1xuICB9O1xuXG4gIEV4aWZSZXN0b3Jlci5yZXN0b3JlID0gZnVuY3Rpb24gKG9yaWdGaWxlQmFzZTY0OmFueSwgcmVzaXplZEZpbGVCYXNlNjQ6YW55KSB7XG4gICAgaWYgKG9yaWdGaWxlQmFzZTY0Lm1hdGNoKCdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcpKSB7XG4gICAgICBvcmlnRmlsZUJhc2U2NCA9IG9yaWdGaWxlQmFzZTY0LnJlcGxhY2UoJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJywgJycpO1xuICAgIH1cblxuICAgIHZhciByYXdJbWFnZTpudW1iZXJbXSA9IHRoaXMuZGVjb2RlNjQob3JpZ0ZpbGVCYXNlNjQpO1xuICAgIHZhciBzZWdtZW50cyA9IHRoaXMuc2xpY2UyU2VnbWVudHMocmF3SW1hZ2UpO1xuXG4gICAgdmFyIGltYWdlID0gdGhpcy5leGlmTWFuaXB1bGF0aW9uKHJlc2l6ZWRGaWxlQmFzZTY0LCBzZWdtZW50cyk7XG5cbiAgICByZXR1cm4gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyArIHRoaXMuZW5jb2RlNjQoaW1hZ2UpO1xuICB9O1xuXG5cbiAgRXhpZlJlc3RvcmVyLmV4aWZNYW5pcHVsYXRpb24gPSBmdW5jdGlvbiAocmVzaXplZEZpbGVCYXNlNjQ6YW55LCBzZWdtZW50czphbnkpIHtcbiAgICB2YXIgZXhpZkFycmF5ID0gdGhpcy5nZXRFeGlmQXJyYXkoc2VnbWVudHMpLFxuICAgICAgbmV3SW1hZ2VBcnJheSA9IHRoaXMuaW5zZXJ0RXhpZihyZXNpemVkRmlsZUJhc2U2NCwgZXhpZkFycmF5KTtcbiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkobmV3SW1hZ2VBcnJheSk7XG4gIH07XG5cbiAgRXhpZlJlc3RvcmVyLmdldEV4aWZBcnJheSA9IGZ1bmN0aW9uIChzZWdtZW50czpudW1iZXJbXVtdKSB7XG4gICAgdmFyIHNlZztcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHNlZ21lbnRzLmxlbmd0aDsgeCsrKSB7XG4gICAgICBzZWcgPSBzZWdtZW50c1t4XTtcbiAgICAgIGlmIChzZWdbMF0gPT09IDI1NSAmJiBzZWdbMV0gPT09IDIyNSkgLy8oZmYgZTEpXG4gICAgICB7XG4gICAgICAgIHJldHVybiBzZWc7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfTtcblxuXG4gIEV4aWZSZXN0b3Jlci5pbnNlcnRFeGlmID0gZnVuY3Rpb24gKHJlc2l6ZWRGaWxlQmFzZTY0OmFueSwgZXhpZkFycmF5OmFueSkge1xuICAgIHZhciBpbWFnZURhdGEgPSByZXNpemVkRmlsZUJhc2U2NC5yZXBsYWNlKCdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcsICcnKSxcbiAgICAgIGJ1ZiA9IHRoaXMuZGVjb2RlNjQoaW1hZ2VEYXRhKSxcbiAgICAgIHNlcGFyYXRlUG9pbnQgPSBidWYuaW5kZXhPZigyNTUsIDMpLFxuICAgICAgbWFlID0gYnVmLnNsaWNlKDAsIHNlcGFyYXRlUG9pbnQpLFxuICAgICAgYXRvID0gYnVmLnNsaWNlKHNlcGFyYXRlUG9pbnQpLFxuICAgICAgYXJyYXkgPSBtYWU7XG5cbiAgICBhcnJheSA9IGFycmF5LmNvbmNhdChleGlmQXJyYXkpO1xuICAgIGFycmF5ID0gYXJyYXkuY29uY2F0KGF0byk7XG4gICAgcmV0dXJuIGFycmF5O1xuICB9O1xuXG5cbiAgRXhpZlJlc3RvcmVyLnNsaWNlMlNlZ21lbnRzID0gZnVuY3Rpb24oXG4gICAgcmF3SW1hZ2VBcnJheTpudW1iZXJbXVxuICApIHtcbiAgICB2YXIgaGVhZDpudW1iZXIgPSAwLFxuICAgICAgc2VnbWVudHM6bnVtYmVyW11bXSA9IFtdO1xuXG4gICAgd2hpbGUgKDEpIHtcbiAgICAgIGlmIChyYXdJbWFnZUFycmF5W2hlYWRdID09PSAyNTUgJiYgcmF3SW1hZ2VBcnJheVtoZWFkICsgMV0gPT09IDIxOCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChyYXdJbWFnZUFycmF5W2hlYWRdID09PSAyNTUgJiYgcmF3SW1hZ2VBcnJheVtoZWFkICsgMV0gPT09IDIxNikge1xuICAgICAgICBoZWFkICs9IDI7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdmFyIGxlbmd0aCA9IHJhd0ltYWdlQXJyYXlbaGVhZCArIDJdICogMjU2ICsgcmF3SW1hZ2VBcnJheVtoZWFkICsgM11cbiAgICAgICAgdmFyIGVuZFBvaW50ID0gaGVhZCArIGxlbmd0aCArIDJcbiAgICAgICAgdmFyIHNlZzpudW1iZXJbXSA9IHJhd0ltYWdlQXJyYXkuc2xpY2UoaGVhZCwgZW5kUG9pbnQpXG4gICAgICAgIHNlZ21lbnRzLnB1c2goc2VnKTtcbiAgICAgICAgaGVhZCA9IGVuZFBvaW50O1xuICAgICAgfVxuICAgICAgaWYgKGhlYWQgPiByYXdJbWFnZUFycmF5Lmxlbmd0aCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc2VnbWVudHM7XG4gIH07XG5cblxuICBFeGlmUmVzdG9yZXIuZGVjb2RlNjQgPSBmdW5jdGlvbiAoXG4gICAgaW5wdXQ6YW55XG4gICk6bnVtYmVyW117XG4gICAgdmFyIGNocjEsIGNocjIsIGNocjM6YW55ID0gJycsXG4gICAgICBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0OmFueSA9ICcnLFxuICAgICAgaSA9IDAsXG4gICAgICBidWY6bnVtYmVyW10gPSBbXTtcblxuICAgIC8vIHJlbW92ZSBhbGwgY2hhcmFjdGVycyB0aGF0IGFyZSBub3QgQS1aLCBhLXosIDAtOSwgKywgLywgb3IgPVxuICAgIHZhciBiYXNlNjR0ZXN0ID0gL1teQS1aYS16MC05XFwrXFwvXFw9XS9nO1xuICAgIGlmIChiYXNlNjR0ZXN0LmV4ZWMoaW5wdXQpKSB7XG4gICAgICBjb25zb2xlLmxvZygnVGhlcmUgd2VyZSBpbnZhbGlkIGJhc2U2NCBjaGFyYWN0ZXJzIGluIHRoZSBpbnB1dCB0ZXh0LicpO1xuICAgIH1cbiAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoL1teQS1aYS16MC05XFwrXFwvXFw9XS9nLCAnJyk7XG5cbiAgICBkbyB7XG4gICAgICBlbmMxID0gdGhpcy5LRVlfU1RSLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgZW5jMiA9IHRoaXMuS0VZX1NUUi5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgIGVuYzMgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICBlbmM0ID0gdGhpcy5LRVlfU1RSLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuXG4gICAgICBjaHIxID0gKGVuYzEgPDwgMikgfCAoZW5jMiA+PiA0KTtcbiAgICAgIGNocjIgPSAoKGVuYzIgJiAxNSkgPDwgNCkgfCAoZW5jMyA+PiAyKTtcbiAgICAgIGNocjMgPSAoKGVuYzMgJiAzKSA8PCA2KSB8IGVuYzQ7XG5cbiAgICAgIGJ1Zi5wdXNoKGNocjEpO1xuXG4gICAgICBpZiAoZW5jMyAhPT0gNjQpIHtcbiAgICAgICAgYnVmLnB1c2goY2hyMik7XG4gICAgICB9XG4gICAgICBpZiAoZW5jNCAhPT0gNjQpIHtcbiAgICAgICAgYnVmLnB1c2goY2hyMyk7XG4gICAgICB9XG5cbiAgICAgIGNocjEgPSBjaHIyID0gY2hyMyA9ICcnO1xuICAgICAgZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9ICcnO1xuXG4gICAgfSB3aGlsZSAoaSA8IGlucHV0Lmxlbmd0aCk7XG5cbiAgICByZXR1cm4gYnVmO1xuICB9O1xuXG4gIHJldHVybiBFeGlmUmVzdG9yZXIucmVzdG9yZShvcmlnLCByZXNpemVkKTsgIC8vPD0gRVhJRlxufTtcblxuZnVuY3Rpb24gYmxvYlRvRmlsZSh0aGVCbG9iOiBCbG9iLCBmaWxlTmFtZTpzdHJpbmcpOiBGaWxlIHtcbiAgdmFyIGI6IGFueSA9IHRoZUJsb2I7XG4gIC8vQSBCbG9iKCkgaXMgYWxtb3N0IGEgRmlsZSgpIC0gaXQncyBqdXN0IG1pc3NpbmcgdGhlIHR3byBwcm9wZXJ0aWVzIGJlbG93IHdoaWNoIHdlIHdpbGwgYWRkXG4gIGIubGFzdE1vZGlmaWVkRGF0ZSA9IG5ldyBEYXRlKCk7XG4gIGIubmFtZSA9IGZpbGVOYW1lO1xuXG4gIC8vQ2FzdCB0byBhIEZpbGUoKSB0eXBlXG4gIHJldHVybiA8RmlsZT50aGVCbG9iO1xufVxuIl19